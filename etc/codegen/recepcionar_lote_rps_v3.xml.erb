<?xml version="1.0" encoding="UTF-8"?>
<p:EnviarLoteRpsEnvio
  xmlns:ds="http://www.w3.org/2000/09/xmldsig#"
  xmlns:p="http://www.ginfes.com.br/servico_enviar_lote_rps_envio_v03.xsd"
  xmlns:p1="http://www.ginfes.com.br/tipos_v03.xsd"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <p:LoteRps <%= if_param('LoteRps', 'Id') { |val| "Id='#{ val }'" } %>>
    <p1:NumeroLote><%= param('LoteRps', 'NumeroLote') %></p1:NumeroLote>
    <p1:Cnpj><%= param('LoteRps', 'Cnpj') %></p1:Cnpj>
    <p1:InscricaoMunicipal><%= param('LoteRps', 'InscricaoMunicipal') %></p1:InscricaoMunicipal>
    <p1:QuantidadeRps><%= param('LoteRps', 'ListaRps').size %></p1:QuantidadeRps>
    <p1:ListaRps>
      <% param('LoteRps', 'ListaRps').each do |rps| %>
        <p1:Rps>
          <p1:InfRps <%= if_param('Id', with: rps) { |val| "Id='#{ val }'" } %>>
            <p1:IdentificacaoRps>
              <p1:Numero><%= param('InfRps', 'IdentificacaoRps', 'Numero', with: rps) %></p1:Numero>
              <p1:Serie><%= param('InfRps', 'IdentificacaoRps', 'Serie', with: rps) %></p1:Serie>
              <p1:Tipo><%= param('InfRps', 'IdentificacaoRps', 'Tipo', with: rps) %></p1:Tipo>
            </p1:IdentificacaoRps>
            <p1:DataEmissao><%= param('InfRps', 'DataEmissao', with: rps) %></p1:DataEmissao>
            <p1:NaturezaOperacao><%= param('InfRps', 'NaturezaOperacao', with: rps) %></p1:NaturezaOperacao>
            <% if_param('InfRps', 'RegimeEspecialTributacao', with: rps) do |val| %>
              <p1:RegimeEspecialTributacao><%= val %></p1:RegimeEspecialTributacao>
            <% end %>
            <p1:OptanteSimplesNacional><%= param('InfRps', 'OptanteSimplesNacional', with: rps) %></p1:OptanteSimplesNacional>
            <p1:IncentivadorCultural><%= param('InfRps', 'IncentivadorCultural', with: rps) %></p1:IncentivadorCultural>
            <p1:Status><%= param('InfRps', 'IdentificacaoRps', 'Status', with: rps) %></p1:Status>
            <% if_param('InfRps', 'RpsSubstituido', with: rps) do |sub| %>
              <p1:RpsSubstituido>
                <p1:Numero><%= param('Numero', with: sub) %></p1:Numero>
                <p1:Serie><%= param('Serie', with: sub) %></p1:Serie>
                <p1:Tipo><%= param('Tipo', with: sub) %></p1:Tipo>
              </p1:RpsSubstituido>
            <% end %>
            <p1:Servico>
              <p1:Valores>
                <% param('InfRps', 'Servico', 'Valores', with: rps).tap do |values| %>
                  <p1:ValorServicos><%= param('ValorServicos', with: values) %></p1:ValorServicos>
                  <p1:IssRetido><%= param('IssRetido', with: values) %></p1:IssRetido>
                  <% if_param('ValorDeducoes', with: values) do |val| %>
                    <p1:ValorDeducoes><%= val %></p1:ValorDeducoes>
                  <% end %>
                  <% if_param('ValorPis', with: values) do |val| %>
                    <p1:ValorPis><%= val %></p1:ValorPis>
                  <% end %>
                  <% if_param('ValorCofins', with: values) do |val| %>
                    <p1:ValorCofins><%= val %></p1:ValorCofins>
                  <% end %>
                  <% if_param('ValorInss', with: values) do |val| %>
                    <p1:ValorInss><%= val %></p1:ValorInss>
                  <% end %>
                  <% if_param('ValorIr', with: values) do |val| %>
                    <p1:ValorIr><%= val %></p1:ValorIr>
                  <% end %>
                  <% if_param('ValorCsll', with: values) do |val| %>
                    <p1:ValorCsll><%= val %></p1:ValorCsll>
                  <% end %>
                  <% if_param('ValorIss', with: values) do |val| %>
                    <p1:ValorIss><%= val %></p1:ValorIss>
                  <% end %>
                  <% if_param('ValorIssRetido', with: values) do |val| %>
                    <p1:ValorIssRetido><%= val %></p1:ValorIssRetido>
                  <% end %>
                  <% if_param('OutrasRetencoes', with: values) do |val| %>
                    <p1:OutrasRetencoes><%= val %></p1:OutrasRetencoes>
                  <% end %>
                  <% if_param('BaseCalculo', with: values) do |val| %>
                    <p1:BaseCalculo><%= val %></p1:BaseCalculo>
                  <% end %>
                  <% if_param('Aliquota', with: values) do |val| %>
                    <p1:Aliquota><%= val %></p1:Aliquota>
                  <% end %>
                  <% if_param('ValorLiquidoNfse', with: values) do |val| %>
                    <p1:ValorLiquidoNfse><%= val %></p1:ValorLiquidoNfse>
                  <% end %>
                  <% if_param('DescontoIncondicionado', with: values) do |val| %>
                    <p1:DescontoIncondicionado><%= val %></p1:DescontoIncondicionado>
                  <% end %>
                  <% if_param('DescontoCondicionado', with: values) do |val| %>
                    <p1:DescontoCondicionado><%= val %></p1:DescontoCondicionado>
                  <% end %>
                <% end %>
              </p1:Valores>
              <p1:ItemListaServico><%= param('InfRps', 'Servico', 'ItemListaServico', with: rps) %></p1:ItemListaServico>
              <% if_param('InfRps', 'Servico', 'CodigoCnae', with: rps) do |val| %>
                <p1:CodigoCnae><%= val %></p1:CodigoCnae>
              <% end %>
              <% if_param('InfRps', 'Servico', 'CodigoTributacaoMunicipio', with: rps) do |val| %>
                <p1:CodigoTributacaoMunicipio><%= val %></p1:CodigoTributacaoMunicipio>
              <% end %>
              <p1:Discriminacao><%= param('InfRps', 'Servico', 'Discriminacao', with: rps) %></p1:Discriminacao>
              <p1:CodigoMunicipio><%= param('InfRps', 'Servico', 'CodigoMunicipio', with: rps) %></p1:CodigoMunicipio>
            </p1:Servico>
            <p1:Prestador>
              <p1:Cnpj><%= param('InfRps', 'Prestador', 'Cnpj', with: rps) %></p1:Cnpj>
              <% if_param('InfRps', 'Prestador', 'InscricaoMunicipal', with: rps) do |val| %>
                <p1:InscricaoMunicipal><%= val %></p1:InscricaoMunicipal>
              <% end %>
            </p1:Prestador>
            <p1:Tomador>
              <p1:IdentificacaoTomador>
                <% if_param('InfRps', 'Tomador', 'CpfCnpj', with: rps) do |val| %>
                  <p1:CpfCnpj>
                    <% if_param('Cnpj', with: val) do |cnpj| %>
                      <p1:Cnpj><%= cnpj %></p1:Cnpj>
                    <% end %>
                    <% if_param('Cpf', with: val) do |cpf| %>
                      <p1:Cpf><%= cpf %></p1:Cpf>
                    <% end %>
                  </p1:CpfCnpj>
                <% end %>
                <% if_param('InfRps', 'Tomador', 'InscricaoMunicipal', with: rps) do |val| %>
                  <p1:InscricaoMunicipal><%= val %></p1:InscricaoMunicipal>
                <% end %>
              </p1:IdentificacaoTomador>
              <p1:RazaoSocial><%= param('InfRps', 'Tomador', 'InscricaoMunicipal', with: rps)%></p1:RazaoSocial>
              <% if_param('InfRps', 'Tomador', 'Endereco', with: rps) do |endr| %>
                <p1:Endereco>
                  <% if_param('Endereco', with: endr) do |val| %>
                    <p1:Endereco><%= val %></p1:Endereco>
                  <% end %>
                  <% if_param('NumeroLote', with: endr) do |val| %>
                    <p1:NumeroLote><%= val %></p1:NumeroLote>
                  <% end %>
                  <% if_param('Complemento', with: endr) do |val| %>
                    <p1:Complemento><%= val %></p1:Complemento>
                  <% end %>
                  <% if_param('Bairro', with: endr) do |val| %>
                    <p1:Bairro><%= val %></p1:Bairro>
                  <% end %>
                  <% if_param('CodigoMunicipio', with: endr) do |val| %>
                    <p1:CodigoMunicipio><%= val %></p1:CodigoMunicipio>
                  <% end %>
                  <% if_param('Uf', with: endr) do |val| %>
                    <p1:Uf><%= val %></p1:Uf>
                  <% end %>
                  <% if_param('Cep', with: endr) do |val| %>
                    <p1:Cep><%= val %></p1:Cep>
                  <% end %>
                </p1:Endereco>
              <% end %>
              <% if_param('InfRps', 'Tomador', 'Contato', with: rps) do |cnt| %>
                <p1:Contato>
                  <% if_param('Telefone', with: cnt) do |val| %>
                    <p1:Telefone><%= val %></p1:Telefone>
                  <% end %>
                  <% if_param('Email', with: cnt) do |val| %>
                    <p1:Email><%= val %></p1:Email>
                  <% end %>
                </p1:Contato>
              <% end %>
            </p1:Tomador>
            <p1:IntermediarioServico>
              <% if_param('InfRps', 'IntermediarioServico', 'CpfCnpj', with: rps) do |val| %>
                <p1:CpfCnpj>
                  <% if_param('Cnpj', with: val) do |cnpj| %>
                    <p1:Cnpj><%= cnpj %></p1:Cnpj>
                  <% end %>
                  <% if_param('Cpf', with: val) do |cpf| %>
                    <p1:Cpf><%= cpf %></p1:Cpf>
                  <% end %>
                </p1:CpfCnpj>
              <% end %>
              <% if_param('InfRps', 'IntermediarioServico', 'InscricaoMunicipal', with: rps) do |val| %>
                <p1:InscricaoMunicipal><%= val %></p1:InscricaoMunicipal>
              <% end %>
              <p1:RazaoSocial><%= param('InfRps', 'IntermediarioServico', 'RazaoSocial', with: rps) %></p1:RazaoSocial>
            </p1:IntermediarioServico>
            <% if_param('InfRps', 'ConstrucaoCivil', with: rps) do |cc| %>
              <p1:ConstrucaoCivil>
                <p1:CodigoObra><%= param('CodigoObra', with: cc) %></p1:CodigoObra>
                <p1:Art><%= param('Art', with: cc) %></p1:Art>
              </p1:ConstrucaoCivil>
            <% end %>
          </p1:InfRps>
        </p1:Rps>
      <% end %>
    </p1:ListaRps>
  </p:LoteRps>
  <%= render '_signature.xml.erb' %>
</p:EnviarLoteRpsEnvio>
